# Partial Duplicate Video Retrieval with Deep Metric Learning
This repository contains the implementation of the term project for 21 Fall-HKUST CSIT 5910.
It provides code for training and evalutation of a Deep Metric Learning (DML) network on the problem of Near-Duplicate 
Video Retrieval (NDVR). During training, the DML network is fed with video triplets, generated by a *triplet generator*.
The network is trained based on the *triplet loss function*.  The architecture of the network is displayed in the figure below.
For evaluation, *mean Average Precision* (*mAP*) and *Presicion-Recall curve* (*PR-curve*) are calculated.
Two publicly available dataset are supported, namely [VCDB](http://www.yugangjiang.info/research/VCDB/index.html) 
and [CC_WEB_VIDEO](http://vireo.cs.cityu.edu.hk/webvideo/).

<img src="https://raw.githubusercontent.com/MKLab-ITI/ndvr-dml/develop/train_net.png" width="50%">

## Prerequisites
* Python
* Tensorflow 1.xx

## Getting started

### Installation

* Clone this repo:
```bash
git clone https://github.com/MKLab-ITI/ndvr-dml
cd ndvr-dml
```
* You can install all the dependencies by
```bash
pip install -r requirements.txt
```
or
```bash
conda install --file requirements.txt
```

### DML training

* Train the DML network by providing the global features and triplet of VCDB, 
and a directory to save the trained model.
```bash
python train_dml.py --train_set output_data/vcdb_features.npy --triplets output_data/vcdb_triplets.npy --model_path model/ 
```

* Triplets from the CC_WEB_VIDEO can be injected if the global features and triplet of the evaluation set
 are provide.
```bash
python train_dml.py --evaluation_set output_data/cc_web_video_features.npy --evaluation_triplets output_data/cc_web_video_triplets.npy --train_set output_data/vcdb_features.npy --triplets output_data/vcdb_triplets.npy --model_path model/
```

### Evaluation

* Evaluate the performance of the system by providing the trained model path and the global features of the 
CC_WEB_VIDEO.
```bash
python evaluation.py --fusion Early --evaluation_set output_data/cc_vgg_features.npy --model_path model/
````
OR
```bash
python evaluation.py --fusion Late --evaluation_features cc_web_video_feature_files.txt --evaluation_set output_data/cc_vgg_features.npy --model_path model/
```

* The *mAP* and *PR-curve* are returned

## Related Project
**[CC_WEB_VIDEO Downloader](https://github.com/Mi-Dora/CC_WEB_VIDEO_Downloader)**

## Reference Projects

**[Near-Duplicate Video Retrieval  with Deep Metric Learning](https://github.com/MKLab-ITI/ndvr-dml)**

**[Intermediate CNN Features](https://github.com/MKLab-ITI/intermediate-cnn-features)**
